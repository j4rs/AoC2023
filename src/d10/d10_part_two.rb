# frozen_string_literal: true

output = <<~OUTPUT
  .-FL-L777F-F.7-LJF-7.F|7F7.FF---7-F-L|-F-JJ-LL.J-F7.L-LJFF-LFFJ7.FF-F|FFFJ77-F-LF|--7-FL.JJ.F-F7|--F77|JJFLF-|-F-F-7-7-77F-7FF.FF7F7F--|.7.F
  --|J.F-7-|7F|7-|FF-J-7L|JL--.LF|.7J||F77|7.FL-7-77|--L|.F7FLJ--F--7.LL-7|LFL7-FJL|7|J.F|7LJ7..LJJ..LLJJ..F.L7J77LL7L-F-LL|J-J.FFLL7|JJLL7|-|
  |.F-7-L..J-JJL7.||..L|--JF7...-FLJ7|L|J|777.|--J|LJF7--LLJ77.|7L77|F||7|-|L|J.|L|LJJJ7LJ-..FL|FJF7F|.F|L7|FLJ7FLJL|J.--|.|.7FJ-L7.FF.|F|7.FJ
  7J.-J7.FFLF--.-FJ7|--J7--F|77L-|J7|..F.L7-7.J.|J|.F-F7JL-7.F7FLL|-|-JL-JFFF7J-|7F7L7.7L|LLF7||L7||L7.-J|FL..|-||J.LF7|F.F--J|J77|-JLFL|LJF-7
  JJ.FL7|77.L7|-.FJ-|-F.|7J|.FJLFJ7-|.7LJF|.7JJ.L.LFJFL|LLFJ7|.L7||FJ7|7|7L7J|..LFJ|F7-F.L7LL|L7L7L|L|FFL7|L--JLL7.FFFJ-L-.---JLL---7FJ7L|FJ.|
  L7-|JFF77J--|.L|--JFF7LJF--7|LL-|.LF|LF-7.LL77|FLJ-JFF7.-|JF7JL7-7.LJF|7J.L.FL7JFJFL7LL.-7J|-J||-JJLL-.|LF||.FF--FJ|7.|F-.F7J.|L7||7F-7|FJ-7
  F|J|F|LFJ..F|JJ.7FJ-F7FJ7JLJJ-|-7-L|LL||**7.J.FF7..L|JLF-7-7JJ-7-F7|FFJ77FF-JF|.|||FFJ|7L|-JJ.FJ-L-7J|-*******JJ||F***7|LJ|L.|J7L-FJF|FJJF7J
  7-FJF7---77F7.F|J|JF||LJL-.||.FF**.*******J7L7JLL-.L|7F****J|77.FJ77-JLL-777---FJJ|FJ-L77.J|LF7L||--F-J*******|.******-7JLJ77|-JJFLF7.F--J-.
  |JJL-|-JF|FL|-FJF-77||7-JL|J.FFJ**********.|7|J7JJ.********7-|7FJL||7|L|-|L7..L||FLJ7F|FJ--FF**.F7J|J|*******7*******JFJ7FJJFJFL-7.LL7|77|FJ
  L|-7FJJ.7JFJJ|L.JL|-L-L7.**7L**L**************7L7F-********J..L-F77**7FF.|-7.---L7L|L7-7J.F****F|**7LF**************7J||LJFL-.|7JFF7-LJLLL7|
  L7LL-.FJJ-|7FL-77F77.||7F***|*****************7F**J.|-********J.*********.|.|.LL.-.L7|FJJ7****************L*************||LJLFL7JL7JL|F--LJ-
  LL7FJJ|J|-FLJJ..|-JFF-LL-****************|********JF**********7F*********7-FJ..LF-J|7-FJ.L******************************JJJ--7|FJ|J|.FLJJF7J
  F--7JF-FF-FJL-F.|.F|JJ7.LF************************7L*********.7F*********J-****LF7L77-JJ.|**7*************************.|7|-7JJL7-L7L7F7.LLL-
  JFL--J-LL7L77JF-|**J-FJ-**************************************--********J.*****.|****.|J*******************************LJ77|7FL-7FJJ-L-7L|.|
  |7.FJJ7.|.FL|-******-L7L*****************7****************.***7JJ**************F*****.***************J*****************7LF||-|77L-J|J.|JLLF|
  7.-JFF|-JF7J|L******-FF7L.******************.*****************|-F**************************************J************F***.|LL.L-7JJ.77-F-F77|
  L7..J--JF77-J.L|********-F**************************-*******************************************************************-FJ|F7|.F--LL-|F-7|7
  FJ7.JJ|.FL--.7L********************************|*********************J***************************************************J7FLL77|F7JF-F|JLJ7
  |L777L-L777F-J-************F****************************************************|***********************-*****************-LJ7F-L-7-J.-|7FJ7
  L7|.7J7L|F-L|F********L************************************************************L**************************************.FLJ|7F|.F|FF-7-L7
  F|J7.F7-L7.FF**********************************************************-*********************7**|***********************L**77LL-77--JJ--|7.J
  FJJ.|.J7FL|7J******L***.***************|*************************************.************-**********************************.|.|JL-F|J7F|7J
  |FL7F77LF-**7.*******************************************************************F*****************7*************J***********-L-L7.FJ|FFJ7-7
  |LF|--J..|***-**************L*********************|*****************************-**|**********7*********7***************J****|.||JFLL7F-J|JF
  |..L|JJ7.-***.*******.************7*****************************************************************************************|F|-JF-|||J|.--J
  |7FFJLFJ-L*****F*********************************************************************************.********-*******7**-*******J|--L7FJJLF-L7|
  .-F7-FJ|.L**************-************J*********************************************|************|****************************7...|7F-7-|.FF7
  7.L77F7-L-J*****************************-**************************************************************-*******7************J**JJ.FJ-JL|.FL-
  L7FJ-7F-J--*****************************************************************************************************************7**F|-J|F7FLFJJ.
  ||JF7J|JL7.F*******************************L************J**7*******************************************************************7JJLFLJ7-FJF|
  7|-L-7|.J-LL*************************************************************************************************L******************|77|-L77|FF|
  .|7JFL77L|LL.*****************-****************|**|*********7********************************F**********************************FF|L***FL7.L
  -LJ--J||F-77F*********************************************F**************F********J*******************L********************************JL777
  .FL-L7LL|-|-***************************************-*************************************************************F********************J.7|FL
  7--|-L7|JL|.***********************************|**********************-****************************|***********|*******************-JJJ7|L-J
  FJF7F|-7.L|FL***********L**********************************************************************************************************.||-FL7|7
  L77L-J7F7FFF************************L********7*******************************************************-*****************************-|J-7LJL|
  LF|-LL7LJF**********************************************************************************|***************************J***********L***L|.|
  JJ..7LJ7****************L*******-****7***********************************F************7********-********F*******************************F7-7
  ||L||LL***************************-******************************************************************7**************|**7*********J*****.7L7-
  F7-|FF7************L********************************************F*************J**************************************L**********7J7*****.|J7
  -7F**J7F*****************************************|*************************L****F************|**********-**********************7********FJ-7
  L||**-FF*********************************************************.*********************************************************************7-FL7
  F******J***************L***************7****************|****J-************************************|********************************F|.|FJ.|
  F*****************-*************7********************L****************************************************************-******L*******J-7-7FF
  F*************************************F******|*********************7********************************|***********************7********|J.L--|
  |LL**-*******************************************************J******|********.********************************************************.JJ|FL
  J-7.**********************F***********************************************************L**************************************F********7|7L7J
  |FJ-***********-*****7*********************7***************************J**F******************************************************|**JLJ77JF7
  L7||******************F******************************-*************************F***************F*****************|*****************-F-L7-.7J
  .J-F**FLL**************************************************************************************************************************||F.|.|J.
  FL7LL.|F***********-*****J******************************|**7***************************************************************J**J.L**FL--J7.-7
  FFJJ|.****************************L**********************************************************|*********************************.7L|77|J.|.LL
  .FJ-**************7**J**J*************7***********************************************************************7******************7L7-|.7.77L
  FJ||************************7**F******************J***********************************************************************7******J7|L|JL7J|.
  FF--******-***********************F******F*****7*********************************************.*******F**************************-|JF-J|F7|LJ
  LJ7L******************************************************************-*************|L*****************7**********************|J.|7F7F7|F|-J
  .J7JL7***************************************************************|******7*******7***************************************.L|JF7-LJL|-|||J
  7F77.-********-**********************************************F**************************************************************--JFLJ-F-7JJ|7F-
  L7|77.************************************************J****.L|7*********************************************************L**LF|JLLF7-7.|J|.7.
  L-|--*********************F*****************************-**F7.L******J***|**********J***********.****************L************LFF7|JFFL.-7|7
  |.|||****JL************************************.***********7||JL**************7****J.******************L**********************.|L7J7LL|.F-JJ
  F.|--****7-L7|FLL********************************************77..L*********************************F**********************L**---.|.JJF||JLFJ
  |7LLFJLLJ..||-7.L*****|*****************************************F************************.****L******************************F|-J.||-F|J.||J
  LJ7L||J-LF-LJ-J-************************************************************F********|***************************************F--.7L|7|LF-J|J
  F7LF-77-7J.LFJFF*********************************************L*************LF******************F***************|******J******7FLFJFL7-.J7-L7
  FJF7LJ7F|77**7LF*********************************J***********JL*************J.F|*****************|******J*********************7-LLJ7|J.LJ7F-
  LLFJ||*********J**********************************************.**JL*********L--F*******.**************************************7-.L7F7-J7FJ7J
  |.J-77*********L**************************************************-*******-|.L-LLJF********J*********.********************J****J7FL.J.L|-LF7
  7FL7|F7********F*****************7********************************JL-*****.F7JL|FL-J|LL****************************J************LJF-F---J.LL
  F-F7-*******************************************-*****************7||FJ.||FL7LFFF7LJLF********-*********************************-|7|L.7JFJLJ
  L***L*********************************7***************************F|J7.F||F----**JJ-FF************************-********7******J7.FLJJ7F7-JFJ
  F***F**************************************************************J|L7FLJ||F|J**|-************************************************J.LFJJ.J7
  L***************************-***************|*******-***************7.F7-LFF77****J************************************************||F|7|7L7
  L*****************J********7****-**********F************************J.||FL********7J**********************.*************************.-7F-F7J
  F****************************************************************L**JL*************.*************************************************LLJFL||
  |JLL-*************************************************J***********-LJF*******************************-*****F******|****L*******J*******-JFJJ
  .--L****7.**L**************J**.***********************************-|FF***-**********************7.**************************************F|7|
  -7FL****-******|****************7****************************|***|.F*****.**************************************************************-FF7
  FL7JJ.L||**********L**L********************************F*********77F*************************F******************-*********************JFL|L-
  -7.F-FJ*******************************.*************************-*************************7********L*****************.********F*******-7JLFJ
  |-77.|.*****************************L************|***********-**********************************************J***********************.J.|.L|7
  L7J.F|7J******************|*************-************************-*******************.*****J****F*******7*********F***************||.|.7..|7
  ||7.F||*******************************************************L**7**7**L**7******************************************************LJ--JFLLLJJ
  L7--**7**********************|*******************************|*******************************************************************.J||F-7J-||
  ||..*******F***********************************************************************************************F**L****************|**.FF|-.L.F-
  FF-F****************************************************-************************************7**************************************.7J7FF77
  ********7***********************J*********7***************.**L*******************7**************************************************.F77FJFJ
  ****F**L****************************************L**************L********.***********************************|**************7******J.F|LJ.F|J
  F******.**********************************************L**|*****************************************|*******************************-FL7|7F.|
  L******7L**-**********************************************L*****************************|******************************************777LJ-|.F
  LF****JL|JLF.L**********************-*******************************7***************************************F**************L**J**J7||L7FLL.|
  F7F***JFF7LJ-|LF********7*****************************************J*****************************************************************-7FJF|F7
  ||F***F-J7J.F****.*********J***************************************************************7*******************J******L*************|L-.FFFJ
  JJ..J7|J.--7F****************************************|*****************7****************************************-******************-J|-F-LF7
  |F-7JFLF.|-*********************************************************************-*******J******************************************LLL7L|.|.
  FLF7-7F|7JJ******|******************L***************************************-**************************-********************L*****|FLLF7J7||
  7-LF-LJJ...L*******************************.****************************.**************************-************7*****************-L-JL---J7
  JJ||7.J7FL-**L*************F******************************************************************************************L**********JJFF-7.FLLJ
  |.7LJ-FJ-FF*****************7*****************-******************************************************|******************F*****LF|-FFL7|.|.LF
  FF77J-|J-FF**************************************************************************************|***************F*************-**J|-|J|-7.7
  L||.LJ.|7FJ********|******************|******************J***|****************************F**|****F****************************7**FF.|..JLF-
  LLL7FF|F**L****7**-*************7******.****7***************************7*********************************************.***********7|77.FJ7.L
  .|L--LFL******************************************************************************************************************************-J.FJJ
  F|.L7FJL****************************L******************7***J*********************************************************************|****.L-FJJ
  FJ-.FL777*************************J**************************************************************************************.************-F7LF7
  |LLF77JF-**********L****************************************7**|***********************F******F*************-*************************FJ7.L.
  J-.L|JFLJ|****|***************************************************************************************************************.*******J.J7L7
  LL-..-JL-FLL****7*************************************************************J***********7-*****************************************J.----L
  |J|F|JF|7**********************************************************************************************************************-***77FLJFJFL
  7.|FJ-|7-*****************************************************************************************************************.*********77|FL7L|
  |F-JLFJ-********J********************************J*****************F********************************************L*******************LJ77LF7|
  JLJLLLJJ************************F**.***************J****************.***************************************************************7FF-JL|7
  L7F77J.7FF*****J**********************************************************L*********************************************************L|.|-FF7
  F-LJ|7|.|-*****7**|**************************7**********************************************-*******************F*******************7|.JF--J
  -.LFJLJJ..LJ||.************************|*******************************************************************************************JJ7F7L7|.
  |FFJ7JLL7||--L7********F***********************************************|****L**********F*********************-*********************FLLF7-|.J
  |7L||L|J|-J7F|FL******************************7***********************|********F**************************************************L-JFJLFLLJ
  L7JJ|7JF-7FF--J|.L*************************************************************************************************F*****L*******JL|F||J|L|J
  |J|-||L|.-JJJJJFF-********************************************************************7******************************************L-F--7FF7L|
  F7F7-J---L-L.LFF7LL-L********************.************J********************************************7************L****************--JLL.-J-FJ
  7-|7.|||7|7F7.FLJ7|F|J**J****L*********************************************************.*************************-***************-7-7-LJ.||J
  |L||FF7LFF-FLFJ7F7-7JFJ-F**.|FJJ**************7****************F*****************7******************************************J**JJ7LF777|FL-F
  ..FJFJJ7LJF---7F|J||JL|L|-|-L7|.|***********|*********************************************|***********************-**7******F**J7J-|JL77|J7L
  |F|J.|FJ7F-J7L--||JJF7L7J||J7**-***********************************|******L***************************7******-**************-JJ..|-JLL|JJJL|
  LFJ|FLJFJJLL7-|LLJ.F|-F|J-|.-******J***********************************************-***************-******F**J**************J|.F-..|.LJ|7|7|
  LL--J7LJ|..FLF|.FF-.|-F|.7-L.*****L77**************LF*****************7****************L*********J|.*********.***7********FL7LLJJ-L|7-7LJ7JJ
  F7FFLFJFL77L-J|F-L--7.||-7.FF*****7|***************-************************-**********7*****-L***|**************-******.|7.J|.|L.LJ.7|7.-.L
  7L7JLLFF--L.|.L-77L.|-7LJ.LLL******-***********7**|L******-L*********************|**JJL*****L|L*********L******|.7J**J-LLJ.F-777.7.F|.|-|J7.
  J-.|7.FJ-|.-77-J--JFLFF7|77-|**7***JJ****|*******.||L******J**********-************J7L-*****-JJ.|.***J**-**-|7.7F--LJLFJ|.F-7|FL77F--7JL|LL|
  |JLLL7|7J.F|JF7.|L-77|J|7-J--**JJ**7J..F|F*******-|-F|.****J***********************7FL-J****F|.FL7L**77|FLJ-|7-L7J7FL7-JFF77LF-.LL-JF||L-7L|
  -7..F-J|--FJ||.FJLFJF|.LF-|7F**F||LL---FL-*****7J||FF-.***JF*******|*****-****.L**L777F-**J-7.FL7LJ||LL--7L7JJ--JFF---J7LJJF--JFF-L7||L-LL-J
  F77F7L-JL|.FL-J7LF--F-J-L-JFJJ-|-LJF77|L|LL||***|F.F-7-|J|||**J.L**-**********-|LJ7L-J-L|L|-J--7F-7-F-.FLJ.|LL7J-JLJ.|-L7L-J-L7LL7FJLLL7.|7.
  ||.-|--J-J-77|.F7|JJ.|J77.FLL7.L7F--FJJ|L|J.L***JLFJFJL|7FJ-**7.F**|**********7--.FJJ7LFJJF..FL7|.JJL.-7.JJ.||LJ.LLJ.77FJ7|J|F||LFJ.J7.|7L-7
  LL7JJJ7|J.L|F--F|777L-F-|.|JLLJ--F7L||L-.L7F|L**..LL|.F-JJJFLL7-FJFF7*********JLL7LJ.FFLJ..|.JF|--|LF--F.|F|JF-|-.|J.|LJLFJ-L7FJ-777.F|FJJ-|
  L||L|----F.7J..LLJ-FJ-JL|-7.|-|7.L-F7-|FJ-|7F-JJFL..J7|||-F|JLLJF-|7-*****LJ7LJL|-L-FF-J-|7JFLJ|L.|F--F7-F7JLF-J-FL..FFJFJ|FL|JJ|L77.F|J..FJ
  7L|-7F|-|LL77...|J.-7L7-L-7-L.L-7JF||7--|7|||-LJ|JFJ||-|7FFFJ.|F-JLJ||.||..FFFL-|.|--JL77L--|.FJ.J-|JF||.|J.FF-|7F7.-7|F|--F7|..JJ|L7.L7--F7
  --|7.L--||J|J-L-J.7L|L-.FLJ7F7|F|FFJLF7J|JL.L7|7JF-L7||JLF-J|LJ.|JFL-|FJ-L-JLF7FFLF.J.FLJ7J..F|7F|-LF7L--7.FL7FL7777LFJ7|F-LJ7F|7LL.L7F||F|7
  .L77FJ|.|L7||.|.F-F-|7F7-7FL|LJ-J-JJ-|F-|L|FLLJLF|7-FL---7-|JFL-J.LJ-JJ-||.L7----.L7|.----.LFJJL-J.L-L.|LF7LJFJFLJJFL7-F|--7J--.|LJF|L||FJ-.
  7LLL-.7--LJJJ7-7J-JJLJ-JL|--|JL-JJ|.F.FJ.-J.L.|.L.|L|-JJLJ-L--J-J-|LLLL7--7J.|.LJ.|.LJJ--J.LLJLJJ--.LLJ7LJJ.LLJFL--FJL-JJ-7LJLL-|--FLFJ|-LL.
OUTPUT

def day10_part_two(input)
  start = "S"
  north = :north
  south = :south
  east  = :east
  west  = :west

  vertices = []

  pipes = {
    # north and south
    "|" => lambda { |from, row, col|
      inc = from == north ? 1 : -1
      [from, row + inc, col]
    },
    # east and west
    "-" => lambda { |from, row, col|
      inc = from == east ? 1 : -1
      [from, row, col + inc]
    },
    # north and east
    "L" => lambda { |from, row, col|
      vrow, vcol, to = from == north ? [0, 1, east] : [-1, 0, south]
      [to, row + vrow, col + vcol]
    },
    # north and west
    "J" => lambda { |from, row, col|
      vrow, vcol, to = from == north ? [0, -1, west] : [-1, 0, south]
      [to, row + vrow, col + vcol]
    },
    # south and east
    "F" => lambda { |from, row, col|
      vrow, vcol, to = from == south ? [0, 1, east] : [1, 0, north]
      [to, row + vrow, col + vcol]
    },
    # south and west
    "7" => lambda { |from, row, col|
      vrow, vcol, to = from == south ? [0, -1, west] : [1, 0, north]
      [to, row + vrow, col + vcol]
    }
  }

  matrix = input.reduce([]) { |acc, row| acc << row.chars }

  rows = matrix.length
  cols = matrix[0].length

  srow, scol = []
  rows.times.each do |row|
    cols.times.each do |col|
      next unless matrix[row][col] == start

      srow = row
      scol = col
      break
    end
  end

  # Find where to go next from the starting point
  direction, next_row, next_col =
    # north, south, east, west
    if srow.positive? && ["|", "F", "7"].include?(matrix[srow - 1][scol])
      [:south, srow - 1, scol] # go south
    elsif srow < rows && ["|", "J", "L"].include?(matrix[srow + 1][scol])
      [:north, srow + 1, scol] # go north
    elsif scol < cols && ["-", "J", "7"].include?(matrix[srow][scol + 1])
      [:west, srow, scol + 1] # go west
    elsif ["-", "F", "L"].include?(matrix[srow][scol - 1])
      [:east, srow, scol - 1] # go east
    else
      raise "No starting point found"
    end

  start_tile = matrix[next_row][next_col] # -, |, L, 7, ...
  direction, next_row, next_col = pipes[start_tile].call(direction, srow, scol) # next tile based on current one

  vertices = [[next_row, next_col]]

  steps = 1
  next_tile = matrix[next_row][next_col]

  until next_tile == start
    # Find new direction and tile
    direction, next_row, next_col = pipes[next_tile].call(direction, next_row, next_col)
    next_tile = matrix[next_row][next_col]

    vertices << [next_row, next_col] # vertex of the polygon
    steps += 1
  end

  # Uncomment to draw the polygon (at the top of the file)
  # vertices.each { |vertex| draw[vertex[0]][vertex[1]] = "*" }
  # puts draw.map(&:join).join("\n")

  # Shoelace formula
  shoelace_area =
    vertices
      .each_with_index
      .reduce(0) do |area, (vertex, index)|
        next_vertex = vertices[(index + 1) % vertices.length]
        area + (vertex[0] * next_vertex[1]) - (vertex[1] * next_vertex[0])
      end

  shoelace_area /= 2

  # Found the solution on reddit (https://www.reddit.com/r/adventofcode/comments/18evyu9/2023_day_10_solutions/)
  #  /**
  #  * Pick's theorem (https://en.wikipedia.org/wiki/Pick%27s_theorem)
  #  * loopArea = interiorPointsCount + (boundaryPointsCount / 2) - 1
  #  *
  #  * Part 2 answer is interiorPointsCount
  #  * transforming Pick's formula:
  #  * interiorPointsCount = loopArea - (boundaryPointsCount / 2) + 1
  #  *
  #  * boundaryPointsCount is length of loop (practically part1 answer * 2)
  #  *
  #  * loopArea can by calculated using Shoelace formula (https://en.wikipedia.org/wiki/Shoelace_formula):
  #  * vertices = (x1, y1) (x2, y2) (x3, y3) ...
  #  * 2 * loopArea = x1 * y2 - y1 * x2 + x2 * y3 - x3 * y2 + ...
  #  * loopArea = result / 2
  #  */

  shoelace_area.abs - (steps / 2) + 1
end

test = <<~INPUT
  FF7FSF7F7F7F7F7F---7
  L|LJ||||||||||||F--J
  FL-7LJLJ||||||LJL-77
  F--JF--7||LJLJ7F7FJ-
  L---JF-JLJ.||-FJLJJ7
  |F|F-JF---7F7-L7L|7|
  |FFJF7L7F-JF7|JL---7
  7-L-JL7||F7|L7F-7F7|
  L.L7LFJ|||||FJL7||LJ
  L7JLJL-JLJLJL--JLJ.L
INPUT
  .split(/\n/)

pp day10_part_two(test)

file = File.open("d10.txt")
file_data = file.readlines.map(&:chomp)
file.close

pp day10_part_two(file_data)
